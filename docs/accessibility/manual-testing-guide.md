
# NightLoom アクセシビリティ手動テストガイド

## 概要

このドキュメントは、NightLoom診断アプリケーションのアクセシビリティを手動でテストするための包括的なガイドです。WCAG 2.1 AAレベルの準拠を確認し、実際のユーザー体験を検証します。

## テスト環境準備

### 必要なツール

1. **スクリーンリーダー**
   - Windows: NVDA (無料) または JAWS
   - macOS: VoiceOver (内蔵)
   - Linux: Orca

2. **ブラウザ**
   - Chrome/Edge (最新版)
   - Firefox (最新版)
   - Safari (macOS)

3. **ブラウザ拡張機能**
   - axe DevTools
   - WAVE Web Accessibility Evaluator
   - Colour Contrast Analyser

4. **キーボード** (マウス無効化)

### テスト設定

```bash
# 開発サーバー起動
cd frontend && pnpm dev

# アクセシビリティテスト実行
pnpm test -- tests/accessibility/
pnpm test:e2e -- e2e/accessibility-keyboard.spec.ts
```

---

## 1. キーボードナビゲーションテスト

### 1.1 基本的なキーボード操作

**テスト手順:**

1. **Tab順序の確認**
   ```
   1. ページを開く
   2. マウスを無効化
   3. Tabキーで順次移動
   4. 論理的な順序で移動することを確認
   ```

2. **スキップリンクの動作**
   ```
   1. ページ読み込み後、最初にTabキーを押下
   2. "メインコンテンツへスキップ" リンクが表示される
   3. Enterキーで実際にメインコンテンツにジャンプする
   ```

3. **フォーカス表示の確認**
   ```
   1. 各インタラクティブ要素にフォーカス移動
   2. 視覚的なフォーカス表示(アウトライン/シャドウ)を確認
   3. フォーカス表示が十分に見やすいことを確認
   ```

**期待される結果:**
- [ ] Tab順序が論理的である
- [ ] スキップリンクが正常に動作する
- [ ] フォーカス表示が明確に見える
- [ ] フォーカストラップが適切に機能する

### 1.2 診断フローでのキーボード操作

**キーワード選択画面:**
```
1. 提案キーワードボタン間をTabで移動
2. 矢印キーでの移動も可能
3. Enter/スペースキーで選択
4. カスタム入力フィールドへのTab移動
5. Enter/Tab で決定ボタンへ移動
```

**シーン選択画面:**
```
1. 選択肢間をTabキーで移動
2. 矢印キー(↓↑)での移動
3. Enter/スペースキーで選択
4. 1-4数字キーでの直接選択
5. Home/Endキーで最初/最後の選択肢に移動
6. Escapeキーでフォーカス解除
```

**結果画面:**
```
1. タイプカードへのフォーカス移動
2. 軸スコア項目間の移動
3. "もう一度診断する"ボタンへの移動
```

**チェックリスト:**
- [ ] すべての操作がキーボードで可能
- [ ] 矢印キーナビゲーションが正常動作
- [ ] 数字キーでの直接選択が動作
- [ ] フォーカスが画面外に移動しない

---

## 2. スクリーンリーダーテスト

### 2.1 NVDA（Windows）でのテスト

**基本操作:**
```
Ctrl + Alt + N : NVDA起動
Insert + Space : フォーカス/ブラウズモード切替
Insert + T : タイトル読み上げ
Insert + F7 : ランドマーク一覧
H/Shift+H : 見出し間移動
K/Shift+K : リンク間移動
B/Shift+B : ボタン間移動
F/Shift+F : フォーム要素間移動
```

**テスト手順:**

1. **ページ構造の確認**
   ```
   1. Insert + F7でランドマーク一覧を開く
   2. main, navigation, banner, contentinfo が適切に認識される
   3. Hキーで見出し階層を確認 (h1 → h2 → h3)
   ```

2. **キーワード選択画面**
   ```
   1. ページタイトル "NightLoom" が読み上げられる
   2. 初期文字 "「あ」で始まる単語を選んでください" が読み上げられる
   3. 提案キーワードが "キーワード候補1: 冒険" として読み上げられる
   4. カスタム入力フィールドのラベルが読み上げられる
   5. 入力制限 "1-20文字" のヘルプテキストが読み上げられる
   ```

3. **シーン選択画面**
   ```
   1. "シーン1" の見出しが読み上げられる
   2. シーンの説明文が読み上げられる
   3. "選択肢1: [テキスト]" として各選択肢が読み上げられる
   4. 選択状況 "選択済み" または "未選択" が伝わる
   5. 進行状況 "1/4" が読み上げられる
   ```

4. **結果画面**
   ```
   1. "診断が完了しました" のアナウンス
   2. タイプ名 "冒険者" が読み上げられる
   3. タイプ説明が読み上げられる
   4. 軸スコア "冒険性: 75点 100点満点" が読み上げられる
   5. プログレスバーの値が読み上げられる
   ```

### 2.2 VoiceOver（macOS）でのテスト

**基本操作:**
```
Cmd + F5 : VoiceOver起動/終了
Ctrl + Option + → : 次の要素
Ctrl + Option + ← : 前の要素
Ctrl + Option + Cmd + H : 見出しナビゲーション
Ctrl + Option + U : ローター (要素一覧)
Ctrl + Option + Space : アクション実行
```

**テスト観点:**
- 読み上げ内容がNVDAと一致するか
- VoiceOver固有の機能（ローター等）で適切にナビゲーションできるか

**チェックリスト:**
- [ ] ページタイトルが適切に読み上げられる
- [ ] ランドマークが正しく認識される
- [ ] 見出し階層が論理的である
- [ ] フォーム要素のラベルとヘルプテキストが読み上げられる
- [ ] 選択状態の変更が通知される
- [ ] エラーメッセージが適切に読み上げられる
- [ ] プログレスバーの進行状況が分かる

---

## 3. 色彩・コントラストテスト

### 3.1 色彩コントラスト比の確認

**ツール使用:**
- Colour Contrast Analyser
- axe DevTools
- WAVE

**テスト項目:**

1. **通常テキスト (4.5:1 以上)**
   ```
   - メインタイトル: #000000 on #ffffff
   - 本文テキスト: #333333 on #ffffff  
   - 説明テキスト: #666666 on #ffffff
   - ナビゲーションリンク: #0066cc on #ffffff
   ```

2. **大きなテキスト (3:1 以上)**
   ```
   - h1見出し (24px以上): #333333 on #ffffff
   - h2見出し (18.5px以上、太字): #444444 on #ffffff
   ```

3. **インタラクティブ要素**
   ```
   - プライマリボタン: #ffffff on #0066cc
   - セカンダリボタン: #333333 on #f5f5f5
   - フォーカス状態: #ffffff on #0052a3
   - ホバー状態: #ffffff on #0052a3
   ```

4. **テーマ別コントラスト**
   ```
   Serene: 青系統の色彩配色
   Adventure: オレンジ系統の色彩配色  
   Focus: 緑系統の色彩配色
   Fallback: グレー系統の色彩配色
   ```

**チェックリスト:**
- [ ] すべてのテキストが基準値以上のコントラスト比を持つ
- [ ] ボタン・リンクの通常/ホバー/フォーカス状態が基準を満たす
- [ ] すべてのテーマで色彩コントラストが適切
- [ ] エラーメッセージが十分なコントラストを持つ

### 3.2 色盲・色弱への対応確認

**テストツール:**
- Coblis (色覚シミュレーター)
- Chrome DevTools の色覚シミュレーション

**テスト項目:**
```
1. 1型色盲（赤色盲）でのテスト
2. 2型色盲（緑色盲）でのテスト  
3. 3型色盲（青色盲）でのテスト
4. 全色盲での確認
```

**チェックポイント:**
- [ ] 色のみに依存した情報伝達がない
- [ ] 選択状態が形状や位置でも識別可能
- [ ] エラー状態が色以外の手段でも伝わる
- [ ] プログレスバーが色以外でも進行状況が分かる

---

## 4. モバイルアクセシビリティテスト

### 4.1 スクリーンサイズテスト

**テスト対象解像度:**
```
- 360px × 640px (小型スマートフォン)
- 375px × 667px (iPhone 8)
- 414px × 896px (iPhone 11)
- 768px × 1024px (iPad)
```

**テスト項目:**
1. レスポンシブデザインの動作
2. タッチターゲットサイズ（最小44px×44px）
3. 横画面での表示
4. ズーム200%での使用可能性

### 4.2 タッチアクセシビリティ

**テスト手順:**
```
1. すべてのボタンが44px×44px以上
2. タップエリアが十分に離れている
3. 誤タップを避ける設計になっている
4. スワイプジェスチャーが適切に動作
```

**チェックリスト:**
- [ ] すべてのタッチターゲットが適切なサイズ
- [ ] タッチターゲット間の間隔が十分
- [ ] ピンチズームが200%まで可能
- [ ] 横画面でも使用可能

---

## 5. パフォーマンス・アクセシビリティテスト

### 5.1 読み込み時間とアクセシビリティ

**テスト項目:**
```
1. 初期表示時間 (3秒以内)
2. キーワード確定後の遷移時間 (2秒以内)
3. 結果表示時間 (3秒以内)
4. 読み込み中の適切なフィードバック
```

**ローディング状態のアクセシビリティ:**
- [ ] aria-live="polite" での読み込み通知
- [ ] 視覚的な読み込み表示（スピナー）
- [ ] 読み込み完了の通知
- [ ] タイムアウト時の適切なエラー表示

### 5.2 エラーハンドリング

**テスト項目:**
```
1. ネットワークエラー
2. サーバーエラー（500番台）
3. 不正な入力値
4. セッションタイムアウト
```

**アクセシビリティ要件:**
- [ ] role="alert" でのエラー通知
- [ ] 具体的で理解しやすいエラーメッセージ
- [ ] 復旧手順の明示
- [ ] 再試行ボタンの提供

---

## 6. ブラウザ横断テスト

### 6.1 対象ブラウザ

**デスクトップ:**
- Chrome (最新版)
- Firefox (最新版)
- Edge (最新版)
- Safari (最新版、macOS)

**モバイル:**
- Chrome Mobile (Android)
- Safari Mobile (iOS)
- Samsung Internet (Android)

### 6.2 ブラウザ別チェック項目

**各ブラウザで確認:**
- [ ] キーボードナビゲーションが正常動作
- [ ] フォーカス表示が適切
- [ ] ARIA属性が正しく解釈される
- [ ] スクリーンリーダー対応が正常
- [ ] 色彩コントラストが適切

---

## 7. 実ユーザーテスト

### 7.1 ユーザビリティテスト準備

**参加者プロフィール:**
- スクリーンリーダーユーザー (全盲)
- キーボードナビゲーションユーザー (運動機能障害)
- 弱視ユーザー (拡大ソフト使用)
- 高齢者ユーザー (一般的なアクセシビリティニーズ)

**テストタスク:**
```
1. 初回アクセス～キーワード選択～診断開始
2. 4シーンの選択体験完走
3. 結果確認と再診断の実行
```

**評価指標:**
- タスク完了率
- エラー発生回数
- 完了時間
- ユーザー満足度
- 改善提案

### 7.2 テスト実施手順

**事前準備:**
```
1. 参加者への事前説明
2. 支援技術の動作確認
3. レコーディング環境整備
4. 緊急時サポート体制確保
```

**テスト実施:**
```
1. 自然な操作での診断体験
2. Think-aloud プロトコル適用
3. 困難な箇所の詳細記録
4. 代替手段の提案収集
```

**事後分析:**
```
1. 定量データの集計
2. 定性フィードバックの整理
3. 改善優先度の決定
4. 実装計画の策定
```

---

## 8. 継続的監視とメンテナンス

### 8.1 自動テストの統合

**CI/CDパイプラインでの実行:**
```bash
# アクセシビリティテストの実行
npm run test:accessibility
npm run test:e2e:accessibility

# カバレッジレポート生成
npm run test:accessibility:coverage
```

**定期実行スケジュール:**
- 毎日: 基本的なアクセシビリティテスト
- 週次: 完全なWCAG準拠テスト
- リリース前: 手動テスト + ユーザビリティテスト

### 8.2 アクセシビリティ品質管理

**品質ゲートライン:**
```
レベル1: axe-core 自動テスト 100%パス
レベル2: キーボードナビゲーション 全機能カバー
レベル3: スクリーンリーダー 主要フロー検証
レベル4: WCAG 2.1 AA 完全準拠
レベル5: 実ユーザーテスト フィードバック反映
```

**監視メトリクス:**
- アクセシビリティエラー数
- WCAG準拠レベル
- スクリーンリーダー対応率
- キーボードナビゲーション成功率
- ユーザビリティテスト評価スコア

### 8.3 チーム教育とガイドライン

**開発チーム向け研修:**
```
1. WCAG 2.1ガイドライン概要
2. aria属性の適切な使用方法
3. キーボードナビゲーション実装
4. スクリーンリーダーテスト手法
5. 色彩コントラスト設計原則
```

**コードレビューチェックポイント:**
- [ ] 適切なセマンティックHTML使用
- [ ] ARIA属性の正しい実装
- [ ] キーボードイベントハンドリング
- [ ] フォーカス管理の実装
- [ ] 色彩コントラスト基準遵守

---

## 9. レポート作成とドキュメント化

### 9.1 テスト結果レポート

**レポート構成:**
```markdown
## アクセシビリティテスト結果報告書

### 1. 実施概要
- テスト実施日: YYYY/MM/DD
- テスト対象: NightLoom v1.0
- テスト実施者: [名前]
- 使用ツール: [ツール一覧]

### 2. テスト結果サマリー
- 全体評価: ✅ WCAG 2.1 AA準拠
- 発見された問題: 3件 (重要度高: 0件, 中: 1件, 低: 2件)
- 修正済み問題: 5件

### 3. 詳細結果
#### 3.1 自動テスト結果
- axe-core: ✅ 違反なし
- WAVE: ✅ エラーなし
- Lighthouse: スコア 95/100

#### 3.2 手動テスト結果
- キーボードナビゲーション: ✅ 合格
- スクリーンリーダー: ✅ 合格
- 色彩コントラスト: ✅ 合格

### 4. 発見された問題
[問題リストと修正提案]

### 5. 推奨事項
[今後の改善提案]
```

### 9.2 継続的改善計画

**四半期レビュー項目:**
```
1. アクセシビリティ基準の最新動向確認
2. 支援技術の進歩に合わせた対応更新
3. ユーザーフィードバックの分析と反映
4. テスト手法の改善と効率化
5. チーム教育計画の見直し
```

**年次目標設定:**
- WCAG 2.2への準拠計画
- 新しい支援技術への対応
- アクセシビリティUXの向上
- テスト自動化の拡充

---

## 10. まとめ

このガイドに従って手動テストを実施することで、NightLoomアプリケーションのアクセシビリティ品質を総合的に評価できます。

**重要なポイント:**
- 自動テストだけでなく手動テストも必須
- 実際の支援技術を使用したテスト
- 多様なユーザーの視点での評価
- 継続的な監視と改善

**次のステップ:**
1. このガイドに基づく初回テスト実施
2. 発見された問題の修正
3. 定期的なテスト計画の策定
4. チーム内でのテスト手法の標準化

アクセシビリティは一度の実装で終わりではなく、継続的な取り組みが重要です。このガイドを活用して、すべてのユーザーにとって使いやすいNightLoomを実現しましょう。
