# NightLoom生成AI機能 UATケース設計書

## 1. はじめに（目的・スコープ）

NightLoom生成AI機能のUAT（受入テスト）は、以下の目的で実施する。

- 生成AI機能（キーワード生成、診断分析、シーン生成、タイププロファイル生成）の品質・信頼性を検証する
- ユーザー体験（診断フロー全体）の妥当性・操作性を検証する
- LLMプロバイダー（OpenAI/Anthropic/Mock）チェーン実行・フォールバック機能の動作を検証する
- 標準化エラー型（LLMError、SessionAPIError）によるエラーハンドリングの正当性を検証する
- セッション管理（インメモリ管理）の動作・一貫性を検証する

本UATは、NightLoomの生成AI機能がユーザー要求・品質基準を満たしていることを確認することをスコープとする。

---

## 2. テストケース分類

- **正常系**
  - 各LLM機能（キーワード生成、診断分析、シーン生成、タイププロファイル生成）が期待通り動作すること
  - 複数プロバイダー（OpenAI/Anthropic/Mock）での正常応答

- **異常系**
  - LLMError、SessionAPIError発生時のエラーハンドリング
  - ネットワーク障害・タイムアウト時の挙動
  - フォールバック（静的データ返却）の動作

- **境界値**
  - レスポンス時間の制約（遅延・タイムアウト）
  - データ量（入力・出力）の最大・最小値

- **統合**
  - フロントエンド・バックエンド間の連携
  - セッション管理の一貫性
  - E2E（ユーザージャーニー）での全体動作

---

## 3. テストシナリオ詳細

- **E2Eテスト（ユーザージャーニー）**
  - 診断フロー全体（入力→分析→結果表示）の一連動作検証
  - 各画面遷移・ユーザー操作の妥当性確認

- **LLM機能単体テスト**
  - キーワード生成、診断分析、シーン生成、タイププロファイル生成の個別API呼び出し
  - 各LLMプロバイダー（OpenAI/Anthropic/Mock）ごとの応答検証

- **フォールバック機能検証**
  - LLMエラー・タイムアウト時に静的データが返却されること
  - プロバイダーチェーン実行の失敗時の挙動確認

- **セッション管理検証**
  - インメモリセッションの一貫性・分離性
  - セッション切替・再利用時の動作

---

## 4. テスト観点・品質基準

- **レスポンス品質**
  - 生成内容の妥当性・一貫性
  - ユーザー要求に対する適合性

- **パフォーマンス**
  - 応答時間（各API/画面表示の遅延）
  - スループット（同時リクエスト処理能力）

- **可用性**
  - エラー率（LLMError、SessionAPIError発生頻度）
  - 復旧時間（障害発生から正常復帰までの時間）

- **ユーザビリティ**
  - 操作性（UI/UXの分かりやすさ）
  - 診断フローの理解しやすさ・誘導性

---

## 5. テスト環境・前提条件

- **LLMプロバイダーAPI設定**
  - OpenAI、Anthropic、Mock（テスト用）のAPIキー・エンドポイント設定
  - プロバイダーチェーン・フォールバック設定

- **テストデータ・ユーザーシナリオ**
  - 代表的な診断入力パターン
  - 境界値（最大・最小データ量）を含むテストデータ
  - 想定ユーザー操作フロー

- **実行タイミング・頻度**
  - バージョンアップ時、リリース前の受入テスト
  - 定期的な品質確認（例：月次）
