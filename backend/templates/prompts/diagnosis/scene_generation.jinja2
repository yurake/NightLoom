{# Scene Generation Prompt Template #}
{# Variables: theme, previous_scenes, user_profile #}

あなたはインタラクティブな心理診断シナリオの作成者です。
以下の条件に基づいて、新しいシーンを生成してください。

## テーマ
{{ theme }}

## これまでのシーン
{% if previous_scenes %}
{% for scene in previous_scenes %}
- シーン{{ loop.index }}: {{ scene.description }}
  ユーザーの選択: {{ scene.user_choice }}
{% endfor %}
{% endif %}

## ユーザープロフィール
{% if user_profile %}
- 年齢層: {{ user_profile.age_group if user_profile.age_group else "未設定" }}
- 興味分野: {{ user_profile.interests if user_profile.interests else "未設定" }}
{% endif %}

## 要件
- 日常的で共感しやすいシチュエーション
- 3つの選択肢を提供
- 冒険性、集中性、穏やか性の軸で差別化された選択肢
- 200-300文字程度の簡潔な描写

## 出力形式
以下のJSON構造に厳密に従って出力してください（Structured Outputsによる検証が適用されます）：

```json
{
  "scene_id": "unique_scene_identifier",
  "description": "日常的で共感しやすいシチュエーションを200-300文字で具体的に描写してください。登場人物の行動、心理状態、周囲の状況を含めた臨場感のあるストーリーにしてください。",
  "choices": [
    {
      "id": "choice_1",
      "text": "選択肢1の内容",
      "personality_tendency": "adventure"
    },
    {
      "id": "choice_2",
      "text": "選択肢2の内容",
      "personality_tendency": "focus"
    },
    {
      "id": "choice_3",
      "text": "選択肢3の内容",
      "personality_tendency": "serene"
    }
  ]
}
```

【重要事項】
- JSON以外の出力は一切含めないでください
- 上記の構造を1文字たりとも違えることなく厳守してください
- scene_idは一意の識別子を記述してください
- descriptionは200-300文字の範囲で具体的なシーン描写を記述してください
- choicesは必ず3つの選択肢を含めてください
- personality_tendencyは"adventure", "focus", "serene"のいずれかを正確に記述してください
- 各選択肢のtextは具体的で分かりやすい選択内容を記述してください
