============================= test session starts ==============================
platform darwin -- Python 3.12.8, pytest-8.4.2, pluggy-1.6.0
rootdir: /Users/yurak/git/NightLoom/backend
configfile: pyproject.toml
plugins: respx-0.22.0, asyncio-1.2.0, anyio-4.11.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 59 items

tests/api/test_bootstrap.py ...........                                  [ 18%]
tests/api/test_choices.py ..............                                 [ 42%]
tests/api/test_health.py ..                                              [ 45%]
tests/api/test_keyword.py ...F........                                   [ 66%]
tests/api/test_results.py ...........                                    [ 84%]
tests/api/test_scenes.py .........                                       [100%]

=================================== FAILURES ===================================
_ TestKeywordConfirmationAPI.test_keyword_confirmation_invalid_session_id_format _
tests/api/test_keyword.py:135: in test_keyword_confirmation_invalid_session_id_format
    assert response.status_code == 400
E   assert 500 == 400
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
=============================== warnings summary ===============================
.venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:323
.venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:323
.venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:323
.venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:323
.venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:323
.venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:323
.venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:323
  /Users/yurak/git/NightLoom/backend/.venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

tests/api/test_bootstrap.py: 25 warnings
tests/api/test_keyword.py: 10 warnings
  /Users/yurak/git/NightLoom/backend/app/services/session.py:84: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    createdAt=datetime.utcnow()

tests/api/test_bootstrap.py: 25 warnings
tests/api/test_keyword.py: 10 warnings
  /Users/yurak/git/NightLoom/backend/app/services/observability.py:32: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "timestamp": datetime.utcnow().isoformat(),

tests/api/test_bootstrap.py::TestBootstrapAPI::test_bootstrap_with_llm_fallback
  /Users/yurak/git/NightLoom/backend/tests/api/test_bootstrap.py:104: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    createdAt=datetime.utcnow()

tests/api/test_choices.py: 11 warnings
tests/api/test_results.py: 9 warnings
tests/api/test_scenes.py: 7 warnings
  /Users/yurak/git/NightLoom/backend/.venv/lib/python3.12/site-packages/pydantic/main.py:253: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)

tests/api/test_choices.py::TestChoiceSubmission::test_submit_choice_valid_session_and_choice
tests/api/test_choices.py::TestChoiceSubmission::test_submit_choice_last_scene_no_next
tests/api/test_choices.py::TestChoiceSubmission::test_submit_choice_llm_service_unavailable
tests/api/test_choices.py::TestChoiceSubmission::test_submit_choice_score_accumulation_tracking
tests/api/test_choices.py::TestChoiceSubmission::test_submit_choice_performance_contract
tests/api/test_choices.py::TestChoiceValidation::test_duplicate_choice_submission
  /Users/yurak/git/NightLoom/backend/app/services/session.py:254: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    timestamp=datetime.utcnow()

tests/api/test_choices.py: 17 warnings
tests/api/test_keyword.py: 1 warning
tests/api/test_results.py: 12 warnings
tests/api/test_scenes.py: 7 warnings
  /Users/yurak/git/NightLoom/backend/app/services/observability.py:328: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return datetime.utcnow().isoformat()

tests/api/test_keyword.py::TestKeywordConfirmationAPI::test_keyword_confirmation_success
tests/api/test_keyword.py::TestKeywordConfirmationAPI::test_keyword_confirmation_custom_keyword
tests/api/test_keyword.py::TestKeywordConfirmationAPI::test_keyword_confirmation_performance
tests/api/test_keyword.py::TestKeywordConfirmationAPI::test_keyword_confirmation_scene_narrative_contains_keyword
tests/api/test_keyword.py::TestKeywordConfirmationEdgeCases::test_keyword_confirmation_japanese_characters
tests/api/test_keyword.py::TestKeywordConfirmationEdgeCases::test_keyword_confirmation_twice_same_session
  /Users/yurak/git/NightLoom/backend/app/services/observability.py:59: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "timestamp": datetime.utcnow().isoformat(),

tests/api/test_keyword.py::TestKeywordConfirmationAPI::test_keyword_confirmation_invalid_session
tests/api/test_keyword.py::TestKeywordConfirmationAPI::test_keyword_confirmation_empty_keyword
tests/api/test_keyword.py::TestKeywordConfirmationAPI::test_keyword_confirmation_too_long_keyword
  /Users/yurak/git/NightLoom/backend/app/services/observability.py:193: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "timestamp": datetime.utcnow().isoformat(),

tests/api/test_results.py::TestResultRetrieval::test_get_result_completed_session
tests/api/test_results.py::TestResultRetrieval::test_get_result_completed_session
tests/api/test_results.py::TestResultRetrieval::test_get_result_completed_session
  /Users/yurak/git/NightLoom/backend/tests/api/test_results.py:88: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    "axes": [axis.dict() for axis in mock_axes],

tests/api/test_results.py::TestResultRetrieval::test_get_result_completed_session
tests/api/test_results.py::TestResultRetrieval::test_get_result_completed_session
tests/api/test_results.py::TestResultRetrieval::test_get_result_completed_session
tests/api/test_results.py::TestResultRetrieval::test_get_result_completed_session
  /Users/yurak/git/NightLoom/backend/tests/api/test_results.py:91: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    "profiles": [profile.dict() for profile in mock_type_profiles],

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/api/test_keyword.py::TestKeywordConfirmationAPI::test_keyword_confirmation_invalid_session_id_format
================== 1 failed, 58 passed, 164 warnings in 4.89s ==================
